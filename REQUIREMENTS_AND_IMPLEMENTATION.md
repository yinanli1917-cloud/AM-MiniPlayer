# 需求实现记录文档

## 用户需求清单

### 1. 歌词库集成 ✅
- **需求**: 使用 amll-ttml-db 替代当前歌词源
- **链接**: https://github.com/Steve-xmh/amll-ttml-db
- **状态**: 待实现

### 2. 歌词动画优化 ✅
- **需求**: 学习 applemusic-like-lyrics 项目实现Apple Music风格动画
- **链接**: https://github.com/Steve-xmh/applemusic-like-lyrics
- **要求**:
  - 逐词动画
  - 时间轴控制
  - 流体背景效果
- **状态**: 待实现

### 3. 三点加载动画优化 ✅
- **需求**: 与第一句歌词协调，三等分时间，优雅过渡
- **问题**: 当前抢先进去第一句歌词，生硬
- **解决**:
  - 三个点改为更大尺寸（6px → 10px）
  - 真正的三等分时间逻辑
  - 作为第零句歌词，第一句歌词开始时模糊
  - 使用Apple Music样式字体大小和间距
- **状态**: 已实现

### 4. 统一三个页面底部控件 ✅
- **需求**: 确保三个页面使用完全相同的控件代码
- **实现**: SharedControls 已完全集成到 LyricsView 和 PlaylistView
- **状态**: 已完成

### 5. 滚动检测和控件隐藏 ✅
- **需求**: 在不影响滚动功能下实现控件隐藏
- **文档**: SCROLL_LOGIC_SUMMARY.md
- **解决**:
  - 非阻塞ScrollDetectorView实现
  - 2秒延迟恢复机制
  - 手动滚动时隐藏控件并显示所有歌词清晰
  - 支持LyricsView和PlaylistView
- **状态**: 已完成

### 6. 歌词获取性能优化
- **问题**: 获取速度慢，容易随机错误
- **需要**: 优化LRCLIB和lyrics.ovh API调用
- **状态**: 待优化

### 7. 渐变遮罩优化 ✅
- **需求**: 将高度从200px减少到80px
- **实现**: 已修复 PlaylistView 和 LyricsView 两个地方
- **状态**: 已完成

### 8. 歌词刷新按钮逻辑 ✅
- **需求**: 在错误状态时显示重试按钮，而不是在控制栏
- **实现**: 重试按钮现在只在歌词加载错误时显示，带有清晰的重试按钮样式
- **状态**: 已完成

### 9. 自定义图标保护 ✅
- **需求**: 保持Gemini设置的自定义图标不受伤
- **方法**: 构建新版本而不覆盖原始应用
- **状态**: 已保护

### 8. 歌单封面获取优化
- **需求**: 优化封面获取功能
- **状态**: 已有基础实现，待优化

### 9. 自定义图标保护 ✅
- **需求**: 保持Gemini设置的自定义图标不受伤
- **位置**: /Users/yinanli/Documents/MusicMiniPlayer/MusicMiniPlayer.app
- **状态**: 需要注意

### 10. 性能优化
- **需求**: 解决动画卡顿问题
- **要求**: 不牺牲任何动画效果
- **状态**: 待优化

## 实现计划

1. **第一阶段**: 修复当前问题
   - 修复渐变遮罩
   - 优化滚动检测
   - 修复刷新按钮逻辑

2. **第二阶段**: 动画优化
   - 实现Apple Music风格歌词动画
   - 优化三点加载动画
   - 性能优化

3. **第三阶段**: 功能集成
   - 集成新的歌词库
   - 统一所有页面控件
   - 最终测试

## 技术注意事项

1. **图标保护**: 构建时避免覆盖 /Users/yinanli/Documents/MusicMiniPlayer/MusicMiniPlayer.app
2. **性能**: 使用drawingGroup()优化复杂动画
3. **状态管理**: 确保滚动状态和控件显示状态正确同步
4. **Git管理**: 重大修改前提交到GitHub

## 版本控制

- 每次重大修改前: `git add . && git commit -m "feat: 实现描述"`
- 推送到GitHub: `git push origin main`

---
*最后更新: 2025-11-24*
*文档状态: 活跃*