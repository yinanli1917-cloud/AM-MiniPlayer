# 滚动和控件隐藏逻辑需求总结

## 核心需求

### 1. 滚动检测
- **目标**：检测用户是否在手动滚动歌词/播放列表
- **要求**：
  - 不能阻塞或干扰 ScrollView 的正常滚动功能
  - 滚动事件必须能够正常传递，页面必须能够流畅滚动
  - 检测应该是非阻塞的、异步的

### 2. 控件隐藏逻辑
- **触发条件**：当用户开始手动滚动时
- **行为**：
  - 立即隐藏底部控件（进度条、播放控制等）
  - 同时取消歌词的模糊效果，显示所有歌词清晰
  - 设置 `isManualScrolling = true` 以禁用自动滚动

### 3. 自动恢复逻辑
- **触发条件**：用户停止滚动 2 秒后
- **行为**：
  - 恢复自动滚动功能（`isManualScrolling = false`）
  - 如果鼠标仍在窗口内（`isHovering == true`），则显示控件
  - 如果鼠标不在窗口内，控件保持隐藏

### 4. 歌词显示状态
- **自动滚动模式**（`isManualScrolling == false`）：
  - 当前歌词行高亮、放大
  - 其他歌词行根据距离应用渐进模糊和透明度
  - 歌词自动滚动到当前行
  
- **手动滚动模式**（`isManualScrolling == true`）：
  - 所有歌词清晰显示，无模糊效果
  - 用户可自由滚动查看所有歌词
  - 不自动滚动到当前行

## 实现要点

1. **非阻塞检测**：使用 `ScrollDetectorView` 作为透明覆盖层，设置 `allowsHitTesting(false)` 确保不拦截触摸事件

2. **状态管理**：
   - `isManualScrolling`：标记是否在手动滚动
   - `showControls`：控制控件显示/隐藏
   - `isHovering`：标记鼠标是否在窗口内
   - `autoScrollTimer`：用于延迟恢复自动滚动

3. **动画过渡**：
   - 控件隐藏/显示使用平滑动画（0.2-0.3秒）
   - 歌词模糊效果切换使用动画过渡

4. **事件处理顺序**：
   - 滚动事件 → 更新状态 → 传递事件（不阻塞）
   - 定时器 → 延迟恢复 → 检查 hover 状态 → 决定是否显示控件

## 当前实现

- 使用 `ScrollDetectorView` 作为非阻塞的滚动检测器
- 通过 `background()` 修饰符添加，不影响滚动
- 使用 `DispatchQueue.main.async` 确保状态更新不阻塞主线程
- 2秒延迟后恢复自动滚动，并根据 hover 状态决定是否显示控件



























